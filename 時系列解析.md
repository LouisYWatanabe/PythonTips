# 時系列解析

> 過去のデータから未来を予測する手法です。

誤差が累積していくデータ（たとえばランダムウォークしているデータ）に対して、回帰分析は無力だと言うことが知られています。

差が一日ごとに累積していくと考えられるデータに対して回帰分析をしたときの検定結果は全く信用できないものとなります。これも時系列分析なら解決できます。

- **自己相関係数(ACF), 偏自己相関係数(PACF)**：過去の値とどれくらい似ているかを表したもの
相関係数の時系列バージョンという感じですね。値も-1から1までの値をとります。
- **(弱)定常性**：データが同一の分布に従うという条件のもと、時間に依存した条件を考える事で時系列データ解析を可能にする時、この前提条件を弱定常といい、データの並び順に意味を見いだすように分析を行う（データの並び順を考慮しない「データが独立に抽出された標本」という前提条件に基づいた分析手法では、時間依存関係を調査することはできないので）
【弱定常性の定義】
弱定常性を持つという定義は、任意のとに対して、以下を全て満たす時に言います。

1. => 平均が一定
1. => 分散が一定
1. => 自己共分散がラグhにのみ依存

- **White Noise**：平均0,分散がある一定の値を鳥、全ての事故共分散が0になっているもの
【定義】

1. => 平均が0
1. => 分散がある一定の値をとる
1. => 自己共分散が0

このWhite Noiseは、時系列モデルにおいて確率的変動を表現するところとして表現することができます。また、White Noiseが弱定常性を満たすことは明らかです。

- **ARモデル（自己回帰モデル）**：自己回帰とは、その名の通り自分のデータと回帰する手法です。ようするに、一日前の値を横軸に、一日後のデータを縦軸にしてプロットし、線を引っ張ると言うイメージです。
強化学習は、エージェントが与えられた環境を取得し観測して行動を起こす。
行動によって環境が変化し、その結果得る報酬を最大化する用に試行錯誤して繰り返し自立的に学習する


- **MAモデル（移動平均モデル）**：普通の移動平均の説明をします。

４　　２　　６　　１０　　１４　　１８

こんなデータがあったとします。　これを３区間移動平均をしてみます。すると……

（４＋２＋６）/３、　(２＋６＋１０）/３、　（６＋１０＋１４）/３、　（１０＋１４＋１８）/３
＝　４　　６　　１０　１４

となりますこれが移動平均。　ようするに３地点の平均をずらしながらやっていったら3点移動平均になるわけです。

ここで、緑の部分に注目。移動平均する際のたんなる計算過程なのですが・・・・・

４番目の移動平均結果　　１４　＝　　　　　　　　　　　　１０＋１４＋１８　　　　　　 ÷３
３番目の移動平均結果　　１０　＝　　　　　　　　　　６＋１０＋１４　　　　　　　　 　÷３
２番目の移動平均結果　　６　　＝　　　　　　　　２＋６＋１０　　　　　　　　　　　　 ÷３
１番目の移動平均結果　　４　　＝　　　　　　４＋２＋６　　　　　　　　　　　　　　　 ÷３

青い部分を見てください。４番目の結果に使用されているデータが３番目２番目の移動平均結果にも用いられていることが分かります。
同じ数字が使われている⇒似ている⇒相関があるということになります。

要するに、「移動平均みたいに、一部同じ数字を使って表されたデータは自己相関を持つ」 ということになるわけです。これを利用したのが移動平均モデル。
ちなみに、ここには書きませんが、式の形は全く移動平均の式に似ていません。「一部同じ数字を使って表されたデータは自己相関を持つ」というところだけが一緒です。

MAモデルだと、一日前と大きな自己相関があるとかいう現象や周期性うまくモデリングすることができます。
また、さきほど説明したARモデルとは密接な関係があるのですが、ここでは紹介しません。

３期移動平均モデル（要するに上の例と同じ）はMA(3)と表します。同様にq期移動平均モデルは
MA(ｑ）と表記します。MA(ｑ）はｑ個同じ数字を使っているわけなので、ｑ期前までとは自己相関があり、ｑ＋１期前のデータとは自己相関がありません。

- **ARMAモデル（自己回帰移動平均モデル）**：（ARモデル、MAモデル）を両方突っ込んだモデルです。

- **ARIMAモデル（自己回帰和分移動平均モデル）**：データの差分を取ってからARMAを適用したモデルです。要するに視点の問題ですね。もともとの値が累積していって生じた モデルだから和分過程。和分過程を元々のARMA過程に直すためには、差分を取ることになるわけです。

Rでは
arima.sim(n=乱数の数, model=list(order=c(p,d,q),ar=c(ARの係数),ma=c(MAの係数)),sd=sqrt(1))

で ｄ 回の和分過程のAR(ｐ）、MA(ｑ）　から生じるデータ（以下はＡＲＩＭＡ（ｐ、ｄ，ｑ）と記します）を作り出すことができます。シミュレーションに便 利。

実際のモデル推定は

arima(データ , order=c(p,d,q)　）

で計算できます　orderのあとのｐ、ｄ、ｑには、それぞれAR(ｐ）、ｄ 回和分、MA(ｑ）モデルの寄せ集めだということの指定をします。この時のモデルをARIMA(ｐ、ｄ、ｑ）と記します。

- **SARIMAモデル（季節自己回帰和分移動平均モデル）**：ＡＲＩＭＡモデルに、さらに周期的な変動（季節変動とか）を取り入れさせたモデルです。

Ｒでは　　arima( データ , order=c(p,d,q),seasonal=list(order=c(pp,dd,qq) )

で 推定可能です。この場合、パラメータの数は　p+d+q+pp+dd+qq　個分推定することになります。この数字の組み合わせのパターンだけでも、嫌になるくらい多くなりますね。ＡＲ（1）にするか、ＡＲ（２）にするかそれとも２回差分をとるか１回でいいのかも考えないと……って延々数値を突っ込みモデ ルを作り続けるのは大変に面倒です。



## $Example$

[$Example$](./timeseries/timeseries.md)